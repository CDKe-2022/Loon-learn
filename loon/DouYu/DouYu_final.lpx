#!name = æ–—é±¼ã€ç­¾åˆ°&å»å¹¿å‘Šã€‘
#!desc = é›†æˆæ–—é±¼å»å¹¿å‘Šä¸è‡ªåŠ¨ç­¾åˆ°åŠŸèƒ½ï¼šç§»é™¤å¼€å±ã€é¦–é¡µè§†é¢‘æµã€é¦–é¡µè½®æ’­å›¾å¹¿å‘Šï¼Œç§»é™¤ç›´æ’­é—´æ‚¬æµ®çª—ï¼Œå¹¶æ”¯æŒæ¯æ—¥ç­¾åˆ°ä»»åŠ¡ã€‚
#!openUrl = https://apps.apple.com/app/id863882795
#!author = å¯è‰ğŸ…¥ & qwen
#!homepage = https://gitlab.com/lodepuly/vpn_tool/-/blob/master/README.md
#!icon = https://gitlab.com/lodepuly/iconlibrary/-/raw/main/App_icon/120px/Douyu.png
#!tag = å»å¹¿å‘Š,ç­¾åˆ°
#!system = iOS
#!system_version = 15
#!loon_version = 3.2.1(745)
#!date = 2026-01-13

[Rule]
# æ‹¦æˆªHTTPDNS
URL-REGEX, ^http:\/\/203\.107\.1\.33\/\d+\/ss, REJECT
URL-REGEX, ^http:\/\/203\.107\.1\.34\/\d+\/ss, REJECT
URL-REGEX, ^http:\/\/linkmicschedule\.douyucdn\.cn\/im_schedule\/im_gate_list, REJECT
IP-CIDR, 119.29.29.98/32, REJECT, no-resolve
IP-CIDR, 119.29.29.99/32, REJECT, no-resolve

# æ‹¦æˆªSTUNè¯·æ±‚
AND, ((DEST-PORT, 18000), (PROTOCOL, STUN)), REJECT
DOMAIN, stun1.douyucdn.cn, REJECT
DOMAIN, stun1.qvb.qcloud.com, REJECT

# è¯·æ±‚é‡å®šå‘
^(http:\/\/)((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\/(hlsh5p1\.douyucdn2\.cn)(.*) 302 $1$5$6

[Rewrite]
# å¼€å±å¹¿å‘Š
^https:\/\/rtbapi\.douyucdn\.cn\/japi\/sign\/app\/getinfo reject-dict

# é¦–é¡µç›´æ’­é—´æ‚¬æµ®çª— - ç›´æ’­é—´æ‚¬æµ®çª—data.pendant_a / ç›´æ’­é—´å®ç®±data.entrance_d
^https:\/\/apiv2\.douyucdn\.cn\/japi\/entrance\/roomRes\/nc\/m\/list response-body-json-del data.pendant_a data.entrance_d data.fix_entrance

# ä¿®æ”¹åº”ç”¨é…ç½® - å¤§ç¥æ¸¸æˆé™ªç©greatGodGameSitterSwitch / å…³æ³¨æ›´å¤šä¸»æ’­å…¥å£followMoreAnchorEntrance / ç›´æ’­æ¨ªå¹…sdklivebanner / é¦–é¡µæ´»åŠ¨æ‚¬æµ®çª—homeActFloatSwitch / å¸¦è´§å¼€å…³bringGoodsSwitch / QQæ¸¸æˆqqGameSwitch
^https:\/\/venus\.douyucdn\.cn\/venus\/config\/static\/update.+keyCodeSet=flow_config response-body-json-replace greatGodGameSitterSwitch 0 followMoreAnchorEntrance 0 sdklivebanner 0 homeActFloatSwitch 0 bringGoodsSwitch 0 qqGameSwitch 0

# å»é™¤ç›´æ’­é¡µé¢ä¸‹æ–¹å¹¿å‘Š
^https:\/\/apiv2\.douyucdn\.cn\/japi\/entrance\/roomRes\/nc\/m\/list response-body-json-del data.fix_entrance data.pendant_top data.sub_act_entrance data.pendant_mobile_b
^https:\/\/rtbapi\.douyucdn\.cn\/japi\/dyadx\/gateway\/app\/getinfo\? reject-dict
^https:\/\/apiv3\.douyucdn\.cn\/mgapi\/yubanc\/api\/yubaTab\/recommendFeedList\? response-body-json-del data.ad
^https:\/\/apiv3\.douyucdn\.cn\/mgapi\/yubanc\/api\/feed\/followedUserFeedList\/v2\? response-body-json-del data.list[2].ad
^https:\/\/apiv3\.douyucdn\.cn\/japi\/ecl\/api\/query\/user\/goods\/list\? response-body-json-jq 'del(.data.details)'
#å»é™¤ç›´æ’­é—´é¡µé¢çš„æ·˜å®å¹¿å‘Š
^https://vpls-videojj-cdn\.oss-cn-beijing\.aliyuncs\.com/live-tag/.*\.json$ response-body-json-jq 'map(del(.ads))'

# é¦–é¡µè½®æ’­å›¾å’Œè§†é¢‘æµå¹¿å‘Š
^https:\/\/apiv2\.douyucdn\.cn\/mgapi\/livenc\/home\/getRecV3 response-body-json-jq '.data.rec_card |= map(.card_banner |= map(select(has("ad") | not))) |.data.rec_cont |= map(select(has("ad") | not))'

[Argument]
DYCookie = switch, true, false, tag = æ–—é±¼cookieè·å–, desc = æ§åˆ¶æ˜¯å¦è·å–æ–—é±¼ç­¾åˆ°ä»»åŠ¡cookie
DYSign = switch, true, false, tag = æ–—é±¼ç­¾åˆ°, desc = æ§åˆ¶æ˜¯å¦æ‰§è¡Œæ–—é±¼ç­¾åˆ°ä»»åŠ¡

[Script]
# è·å–ç­¾åˆ°æ‰€éœ€ Cookieï¼ˆä¸‹æ¬¡ä¸€å®šï¼‰
http-response ^https:\/\/apiv2\.douyucdn\.cn\/H5nc\/welcome\/to script-path=https://github.com/CDKe-2022/Loon-learn/raw/refs/heads/main/loon/DouYu/dy_cookie.js, requires-body=false, timeout=60, tag=æ–—é±¼cookieè·å–, img-url=https://gitlab.com/lodepuly/iconlibrary/-/raw/main/App_icon/120px/Douyu.png, enable = {DYCookie}

# å®šæ—¶ç­¾åˆ°ï¼ˆæ¯å¤© 09:00 æ‰§è¡Œï¼‰
cron "0 9 * * *" script-path=https://github.com/CDKe-2022/Loon-learn/raw/refs/heads/main/loon/DouYu/dy_sign.js, timeout=300, tag=æ–—é±¼æ¯æ—¥ç­¾åˆ°, img-url=https://gitlab.com/lodepuly/iconlibrary/-/raw/main/App_icon/120px/Douyu.png, enable = {DYSign}

[MitM]
hostname = rtbapi.douyucdn.cn, apiv2.douyucdn.cn, venus.douyucdn.cn, apiv3.douyucdn.cn, vpls-videojj-cdn.oss-cn-beijing.aliyuncs.com